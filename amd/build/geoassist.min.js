define(["jquery","core/ajax","core/notification","core/str","core/url","block_gps/leaflet"],function(c,b,d,e,a){return{locateinterval:null,locate:function(){if(typeof(this.locateinterval)!=="undefined"){if(navigator.geolocation){this.locateinterval=setInterval(function(){navigator.geolocation.getCurrentPosition(function(f){b.call([{methodname:"block_gps_locate",args:{lat:f.coords.latitude,lon:f.coords.longitude,alt:f.coords.altitude},done:function(h){if(h=="coordinates_set"){console.log("User moved more than 5m since last position, reloading page");top.location.href=top.location.href}else{if(h=="moved_less_than_5m"){console.log("User moved less than 5m since last position")}else{console.log("There was an error, show notification");var g=e.get_string(h,"block_gps");c.when(g).done(function(i){d.alert(i,"")})}}},fail:d.exception,}])})},5000)}else{alert("geolocation_not_supported")}}},current:function(f){if(navigator.geolocation){M.availability_gps.locatebtn=f;M.availability_gps.locatebtn.value=M.str.availability_gps.loading+"...";navigator.geolocation.getCurrentPosition(function(g){M.availability_gps.locatebtn.value=M.str.availability_gps.current_location;require(["block_gps/geoassist"],function(h){h.coord(g.coords.latitude,g.coords.longitude)})})}else{M.availability_gps.locatebtn.value=M.str.availability_gps.geolocation_not_supported}},init:function(h,i){if(typeof M.availability_gps.marker!=="undefined"){M.availability_gps.marker.setLatLng(L.latLng(h,i));M.availability_gps.map.panTo(L.latLng(h,i))}else{Y.one("#availability_gps_map").removeClass("closed");Y.one("#availability_gps_map_info").removeClass("closed");M.availability_gps.map=L.map("availability_gps_map",{center:[h,i],zoom:13});L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',subdomains:["a","b","c"]}).addTo(M.availability_gps.map);var g=""+a.relativeUrl("/blocks/gps/pix/google-maps-pin-blue.svg");var f=L.icon({iconUrl:g,iconRetinaUrl:g,iconSize:[29,24],iconAnchor:[9,21],popupAnchor:[0,-14]});M.availability_gps.marker=L.marker([h,i],{title:"",draggable:true,icon:f}).addTo(M.availability_gps.map).on("dragend",function(){var j=M.availability_gps.marker.getLatLng();require(["block_gps/geoassist"],function(k){k.coord(j.lat,j.lng)})})}},coord:function(f,g){require(["block_gps/geoassist"],function(h){h.init(f,g)});M.availability_gps.node.one("[name=longitude]").set("value",g);M.availability_gps.node.one("[name=latitude]").set("value",f);M.core_availability.form.update()}}});