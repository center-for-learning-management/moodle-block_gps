define(["jquery","core/ajax","core/notification","core/str","core/url","block_gps/leaflet"],function(a,b,c,d,e){return{locate:function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){b.call([{methodname:"block_gps_locate",args:{lat:e.coords.latitude,lon:e.coords.longitude,alt:e.coords.altitude},done:function(b){if("coordinates_set"==b)top.location.href=top.location.href;else{var e=d.get_string(b,"block_gps");a.when(e).done(function(a){c.alert(a,"")})}},fail:c.exception}])}):alert("geolocation_not_supported")},current:function(a){navigator.geolocation?(M.availability_gps.locatebtn=a,M.availability_gps.locatebtn.value=M.str.availability_gps.loading+"...",navigator.geolocation.getCurrentPosition(function(a){M.availability_gps.locatebtn.value=M.str.availability_gps.current_location,require(["block_gps/geoassist"],function(b){b.coord(a.coords.latitude,a.coords.longitude)})})):M.availability_gps.locatebtn.value=M.str.availability_gps.geolocation_not_supported},init:function(a,b){if("undefined"!=typeof M.availability_gps.marker)M.availability_gps.marker.setLatLng(L.latLng(a,b)),M.availability_gps.map.panTo(L.latLng(a,b));else{Y.one("#availability_gps_map").removeClass("closed"),Y.one("#availability_gps_map_info").removeClass("closed"),M.availability_gps.map=L.map("availability_gps_map",{center:[a,b],zoom:13}),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',subdomains:["a","b","c"]}).addTo(M.availability_gps.map);var c=""+e.relativeUrl("/blocks/gps/pix/google-maps-pin-blue.svg"),d=L.icon({iconUrl:c,iconRetinaUrl:c,iconSize:[29,24],iconAnchor:[9,21],popupAnchor:[0,-14]});M.availability_gps.marker=L.marker([a,b],{title:"",draggable:!0,icon:d}).addTo(M.availability_gps.map).on("dragend",function(){var a=M.availability_gps.marker.getLatLng();require(["block_gps/geoassist"],function(b){b.coord(a.lat,a.lng)})})}},coord:function(a,b){require(["block_gps/geoassist"],function(c){c.init(a,b)}),M.availability_gps.node.one("[name=longitude]").set("value",b),M.availability_gps.node.one("[name=latitude]").set("value",a),M.core_availability.form.update()}}});