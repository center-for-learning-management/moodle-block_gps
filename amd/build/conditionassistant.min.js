define(["jquery","core/ajax","core/notification","core/str","core/url","core/modal_factory","block_gps/leaflet"],function(f,c,d,e,b,a){return{debug:false,coord:function(g,h){M.availability_gps.node.one("[name=longitude]").set("value",h);M.availability_gps.node.one("[name=latitude]").set("value",g);M.core_availability.form.update();this.init()},current:function(h){var g=this;if(navigator.geolocation){M.availability_gps.locatebtn=h;M.availability_gps.locatebtn.value=M.str.availability_gps.loading+"...";navigator.geolocation.getCurrentPosition(function(i){M.availability_gps.locatebtn.value=M.str.availability_gps.current_location;g.coord(i.coords.latitude,i.coords.longitude)})}else{M.availability_gps.locatebtn.value=M.str.availability_gps.geolocation_not_supported}},init:function(g){var h=this;var l=f("[name=latitude]").val();var m=f("[name=longitude]").val();var k=f("[name=accuracy]").val();if(typeof(g)!=="undefined"){f("#availability_gps_map").toggleClass("hidden");if(l==0&&m==0&&navigator.geolocation){navigator.geolocation.getCurrentPosition(function(n){h.coord(n.coords.latitude,n.coords.longitude)})}}if(typeof M.availability_gps.marker!=="undefined"){M.availability_gps.marker.setLatLng(L.latLng(l,m));M.availability_gps.map.panTo(L.latLng(l,m));M.availability_gps.circle.setLatLng(L.latLng(l,m));M.availability_gps.circle.setRadius(k)}else{M.availability_gps.map=L.map("availability_gps_map",{center:[l,m],zoom:13});L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',subdomains:["a","b","c"]}).addTo(M.availability_gps.map);var j=""+b.relativeUrl("/blocks/gps/pix/google-maps-pin-blue.svg");var i=L.icon({iconUrl:j,iconRetinaUrl:j,iconSize:[29,24],iconAnchor:[9,21],popupAnchor:[0,-14]});M.availability_gps.marker=L.marker([l,m],{title:"",draggable:true,icon:i}).addTo(M.availability_gps.map).on("dragend",function(){var n=M.availability_gps.marker.getLatLng();h.coord(n.lat,n.lng)}).on("move",function(){var n=M.availability_gps.marker.getLatLng();M.availability_gps.circle.setLatLng(n)});M.availability_gps.circle=L.circle([l,m],{color:"red",fillColor:"#f03",fillOpacity:0.2,radius:k,}).addTo(M.availability_gps.map)}},initIfShown:function(){console.log("initifshown");if(typeof M.availability_gps.marker!=="undefined"){console.log("is shown");this.init()}},}});